# External Secrets Operator - Helm Release via Crossplane
# ServiceAccount is created separately via Crossplane (after IAM role)
apiVersion: helm.crossplane.io/v1beta1
kind: Release
metadata:
  name: external-secrets
spec:
  forProvider:
    chart:
      name: external-secrets
      repository: https://charts.external-secrets.io
      version: 0.9.11
    namespace: external-secrets
    values:
      installCRDs: true
      serviceAccount:
        create: false  # Created by Crossplane with IRSA annotation
        name: external-secrets
      webhook:
        port: 9443
      certController:
        requeueInterval: 5m
  providerConfigRef:
    name: helm-provider
---
# Create the namespace for ESO (Helm won't create SA, so we need namespace first)
apiVersion: kubernetes.crossplane.io/v1alpha2
kind: Object
metadata:
  name: external-secrets-namespace
spec:
  forProvider:
    manifest:
      apiVersion: v1
      kind: Namespace
      metadata:
        name: external-secrets
  providerConfigRef:
    name: kubernetes-provider
